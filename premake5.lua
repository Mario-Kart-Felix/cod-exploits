depsBasePath = "./deps"

require "premake/zlib"
require "premake/npcap"

zlib.setup
{
	defines = {
		"ZLIB_CONST",
		"ssize_t=int"
	},
	source = path.join(depsBasePath, "zlib"),
}
npcap.setup
{
	source = path.join(depsBasePath, "npcap"),
}

workspace "cod-exploit"
	location "./build"
	objdir "%{wks.location}/obj"
	targetdir "%{wks.location}/bin/%{cfg.architecture}/%{cfg.buildcfg}"
	buildlog "%{wks.location}/obj/%{cfg.architecture}/%{cfg.buildcfg}/%{prj.name}/%{prj.name}.log"
	configurations { "Debug", "Release" }
	platforms { "x86", "x64" }
	
	buildoptions { "/std:c++latest", "/utf-8", "/Zm200" }
	systemversion "10.0.15063.0"

	flags { "StaticRuntime", "NoIncrementalLink", "NoEditAndContinue", "NoMinimalRebuild", "MultiProcessorCompile", "No64BitChecks" }

	configuration "windows"
		defines { "_WINDOWS", "WIN32" }

	configuration "Release*"
		defines { "NDEBUG" }
		optimize "On"

	configuration "Debug*"
		defines { "DEBUG", "_DEBUG" }
		optimize "Debug"
		if symbols ~= nil then
			symbols "On"
		else
			flags { "Symbols" }
		end
		
	project "cod-exploit"
		kind "ConsoleApp"
		language "C++"
		files {
			"./src/**.rc",
			"./src/**.hpp",
			"./src/**.cpp",
		}
		includedirs {
			"%{prj.location}/src",
			"./src",
			"./src",
		}
		resincludedirs {
			"$(ProjectDir)src" -- fix for VS IDE
		}

		-- Pre-compiled header
		pchheader "STDInclude.hpp" -- must be exactly same as used in #include directives
		pchsource "src/STDInclude.cpp" -- real path
		
		linkoptions "/LARGEADDRESSAWARE"

		-- fix vpaths for protobuf sources
		vpaths
		{
			["*"] = { "./src/**" },
		}

		-- Specific configurations
		flags { "UndefinedIdentifiers" }
		warnings "Extra"

		if symbols ~= nil then
			symbols "On"
		else
			flags { "Symbols" }
		end

		configuration "Release*"
			flags {
				"FatalCompileWarnings",
				"FatalLinkWarnings",
			}
		configuration {}
		
		zlib.import()
		npcap.import()
		
	group "External dependencies"
		zlib.project()
