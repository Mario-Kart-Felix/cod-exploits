#pragma once

namespace Game
{
	namespace MW2
	{
		class Client
		{
		public:
			enum PacketDirection
			{
				NONE = 0,
				LOCAL_TO_REMOTE,
				REMOTE_TO_LOCAL
			};

			Client(Handler* handler, Network::Address target);
			~Client();

			int getDirection(Network::Address source, Network::Address target);
			void handle(Network::Packet* packet, bool receiving);

		private:
			typedef Utils::Slot<void(Network::Packet* packet, std::string data, bool receiving)> Callback;

			Handler* handler;
			Network::Address target;
			Network::Packet packetTemplate;

			u_int64 xuid;
			u_short qport;
			u_int challenge;

			std::map<std::string, Callback> oobHandlers;

			bool handleOOB(Network::Packet* packet, bool receiving);
			void handleNetchan(Network::Packet* packet, bool receiving);

			void onOOB(std::string command, Callback callback);
			void send(Network::Packet* packet, std::string data);

			void sendInitialPayload(Network::Packet* packet);

			std::string compressData(std::string data);
		};
	}
}
