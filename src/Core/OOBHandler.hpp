#pragma once

#define OOB_MAGIC "\xFF\xFF\xFF\xFF"

namespace Core
{
	class OOBHandler
	{
	public:
		OOBHandler();

		bool handle(Network::Socket* sock, Network::Address address, std::string_view data);
		void connect(Network::Socket* sock, Network::Address addr, std::string _name, uint64_t _xuid, Utils::Slot<void(OOBHandler*, Network::Socket*, Network::Address)> callback);

		unsigned char getKey()
		{
			return this->key;
		}

	private:
		unsigned char key;
		std::string name;
		uint64_t xuid;
		Utils::Slot<void(OOBHandler*, Network::Socket*, Network::Address)> readyHandler;
		std::map<std::string, Utils::Slot<void(Network::Socket*, Network::Address, std::string data)>> commandHandlers;

		void onCommand(std::string command, Utils::Slot<void(Network::Socket*, Network::Address, std::string data)> callback);
	};
}
