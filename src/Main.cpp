#include "STDInclude.hpp"

#include "Network/Address.hpp"
#include "Network/Socket.hpp"

#include "Core/OOBHandler.hpp"

int main(int /*argc*/, char** /*argv*/)
{
	Network::Socket s;
	Core::OOBHandler oobHandler;

	s.onData([&](Network::Address addr, std::string_view view)
	{
		if (oobHandler.handle(&s, addr, view))
		{
			//printf("Handled data %s\n", view.data());
		}
		else
		{
			//printf("Received data %s\n", view.data());
		}
	});

	Network::Address addr("127.0.0.1:28960");
	oobHandler.connect(&s, addr, [](Network::Socket* sock, Network::Address addr)
	{
		std::string data("\xFE\xFF\xFF\xFF\x01\x00\x00\x00\xFF\xE0\x00\x07\x00\x00\x00\x00\x00\x00\x00\x2B", 0x14);
		data.resize(0x1000);

		sock->send(addr, data);
	});

	_getch();

	return 0;
}
